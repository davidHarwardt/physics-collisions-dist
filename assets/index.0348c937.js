var j=Object.defineProperty;var B=(n,t,e)=>t in n?j(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var m=(n,t,e)=>(B(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();class X{constructor(...t){this.v=t}_makeThis(){return new this.__proto__.constructor(new Array(this.v.length).fill(0))}map(t){const e=this._makeThis();for(var i=0;i<this.v.length;i++)e.v[i]=t(this.v[i],i);return e}zipMap(t,e){return this.map((i,r)=>e(i,t.v[r],r))}reduce(t,e){let i=e;for(var r=0;r<this.v.length;r++)i=t(i,this.v[r],r);return i}zipReduce(t,e,i){return this.reduce((r,s,o)=>e(r,s,t.v[o],o),i)}copy(){return this.map(t=>t)}add(t){return this.zipMap(t,(e,i)=>e+i)}sub(t){return this.zipMap(t,(e,i)=>e-i)}mult(t){return this.zipMap(t,(e,i)=>e*i)}div(t){return this.zipMap(t,(e,i)=>e/i)}addS(t){return this.map(e=>e+t)}subS(t){return this.map(e=>e-t)}multS(t){return this.map(e=>e*t)}divS(t){return this.map(e=>e/t)}dot(t){return this.zipReduce(t,(e,i,r)=>e+i*r,0)}sqrMagnitude(){return this.dot(this)}magnitude(){return Math.sqrt(this.dot(this))}normalized(){return this.divS(this.magnitude())}inverted(){return this.multS(-1)}lerp(t,e){return this.multS(1-e).add(t.multS(e))}toArray(){return this.v.slice()}multM(t){return this.map((e,i)=>{let r=0;for(let s=0;s<t.rows;s++)r+=e*t.at(s,i);return r})}}class h extends X{constructor(t,e){super(t,e)}get x(){return this.v[0]}get y(){return this.v[1]}set x(t){this.v[0]=t}set y(t){this.v[1]=t}}class Y{constructor(...t){this.v=t}_makeThis(){return this.__proto__.constructor(new Array(this.v.length).fill(0))}map(t){const e=this._makeThis();for(var i=0;i<this.v.length;i++)e.v[i]=t(this.v[i],i);return e}zipMap(t,e){return this.map((i,r)=>e(i,t.v[r],r))}reduce(t,e){let i=e;for(var r=0;r<this.v.length;r++)i=t(i,this.v[r],r);return i}zipReduce(t,e,i){return this.reduce((r,s,o)=>e(r,s,t.v[o],o),i)}copy(){return this.map(t=>t)}add(t){return this.zipMap(t,(e,i)=>e+i)}sub(t){return this.zipMap(t,(e,i)=>e-i)}mult(t){return this.zipMap(t,(e,i)=>e*i)}div(t){return this.zipMap(t,(e,i)=>e/i)}addS(t){return this.map(e=>e+t)}subS(t){return this.map(e=>e-t)}multS(t){return this.map(e=>e*t)}divS(t){return this.map(e=>e/t)}dot(t){return this.zipReduce(t,(e,i,r)=>e+i*r,0)}sqrMagnitude(){return this.dot(this)}magnitude(){return Math.sqrt(this.dot(this))}normalized(){return this.divS(this.magnitude())}inverted(){return this.multS(-1)}lerp(t,e){return this.multS(1-e).add(t.multS(e))}toArray(){return this.v.slice()}multM(t){return this.map((e,i)=>{let r=0;for(let s=0;s<t.rows;s++)r+=e*t.at(s,i);return r})}}class O extends Y{constructor(t,e,i,r){super(t,e,i,r)}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}set x(t){this.v[0]=t}set y(t){this.v[1]=t}set z(t){this.v[2]=t}set w(t){this.v[3]=t}}function U(n,t,e){return Math.min(Math.max(n,t),e)}class a{constructor(t,e,i,r=1){this.v=new O(t,e,i,r)}static get black(){return new a(0,0,0)}static get white(){return new a(1,1,1)}static get red(){return new a(1,0,0)}static get green(){return new a(0,1,0)}static get blue(){return new a(0,0,1)}static hex(t){if(typeof t=="number")return new a((t>>8*2&255)/255,(t>>8*1&255)/255,(t>>8*0&255)/255);if(!t.startsWith("#")||t.length!==7&&t.length!==9)throw new Error("invalid color string");let e=new Array((t.length-1)/2);for(let i=0;i<(t.length-1)/2;i++)e[i]=parseInt(t.substring(2*i+1,2*i+3),16)/255;return new a(e[0],e[1],e[2],e==null?void 0:e[3])}static hsl(t,e,i){}static vec(t){return new a(t.x,t.y,t.z,t.w)}hexComponent(t){return Math.floor(U(t,0,1)*255).toString(16).padStart(2,"0")}toRgbString(t=this.a!==1){return`rgb${t?"a":""}(${Math.floor(this.r*255)}, ${Math.floor(this.g*255)}, ${Math.floor(this.b*255)}${t?", "+Math.floor(this.a*255):""})`}toHexString(t=this.a!==1){return`#${this.hexComponent(this.r)}${this.hexComponent(this.g)}${this.hexComponent(this.b)}${t?this.hexComponent(this.a):""}`}toString(){return this.toHexString()}toVec(){return this.v.copy()}toArray(){return this.v.toArray()}mix(t,e=.5){const i=new a(0,0,0,0);return i.v=this.v.multS(e).add(t.v.multS(1-e)),i}withAlpha(t){const e=this.clone();return e.a=t,e}get r(){return this.v.x}get g(){return this.v.y}get b(){return this.v.z}get a(){return this.v.w}set r(t){this.v.x=t}set g(t){this.v.y=t}set b(t){this.v.z=t}set a(t){this.v.w=t}clone(){return new a(this.r,this.g,this.b,this.a)}}class R{constructor(t){this.element=t,this.ctx=this.element.getContext("2d"),this.plugins=[]}static fromParent(t){const e=document.createElement("canvas");return t.appendChild(e),new R(e)}addPlugin(t){this.plugins.push(t)}clear(){this.ctx.clearRect(0,0,this.element.width,this.element.height)}beginDraw(){this.plugins.forEach(t=>t.beforeDrawBegin(this))}endDraw(){this.plugins.forEach(t=>t.afterDrawEnd(this))}draw(t){t(this.ctx)}drawLine(t,e,i={}){var r,s,o,l;this.ctx.lineWidth=(r=i.width)!==null&&r!==void 0?r:10,this.ctx.strokeStyle=(o=(s=i.color)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:a.red.toString(),this.ctx.lineCap=(l=i.cap)!==null&&l!==void 0?l:"butt",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}drawRect(t,e,i={}){var r,s,o,l;this.ctx.beginPath(),this.ctx.rect(t.x,t.y,e.x,e.y),i.fill!==!1&&(this.ctx.fillStyle=(s=(r=i.color)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:a.green.toString(),this.ctx.fill()),i.borderWidth>0&&(this.ctx.strokeStyle=(l=(o=i.borderColor)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:a.red.toString(),this.ctx.lineWidth=i.borderWidth,this.ctx.stroke())}drawCircle(t,e,i={}){var r,s,o,l;this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2),i.fill!==!1&&(this.ctx.fillStyle=(s=(r=i.color)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:a.green.toString(),this.ctx.fill()),i.borderWidth>0&&(this.ctx.strokeStyle=(l=(o=i.borderColor)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:a.red.toString(),this.ctx.lineWidth=i.borderWidth,this.ctx.stroke())}drawPoly(t,e={}){var i,r,s,o;if(t.length<2){console.error(`invalid vertex count for polygon: ${t.length}`);return}this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++)this.ctx.lineTo(t[l].x,t[l].y);e.closed===!0&&this.ctx.closePath(),e.fill!==!1&&(this.ctx.fillStyle=(r=(i=e.color)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:a.green.toString(),this.ctx.fill()),e.borderWidth>0&&(this.ctx.strokeStyle=(o=(s=e.borderColor)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:a.red.toString(),this.ctx.lineWidth=e.borderWidth,this.ctx.stroke())}drawBezier(t,e={}){}drawText(t,e,i={}){var r,s,o,l,u,g;this.ctx.fillStyle=(s=(r=i.color)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:a.white.toString(),this.ctx.textAlign=(o=i.align)!==null&&o!==void 0?o:"left",this.ctx.font=`${(l=i.size)!==null&&l!==void 0?l:50}px ${(u=i.font)!==null&&u!==void 0?u:"Arial"}`,this.ctx.textBaseline=(g=i.baseLine)!==null&&g!==void 0?g:"top",i.debug&&this.ctx.measureText(t),this.ctx.fillText(t,e.x,e.y,i.maxWidth)}drawImage(t,e,i=new h(t.width,t.height),r){r?this.ctx.drawImage(t,r.start.x,r.start.y,r.dim.x,r.dim.y,e.x,e.y,i.x,i.y):this.ctx.drawImage(t,e.x,e.y,i.x,i.y)}translate(t){this.ctx.translate(t.x,t.y)}scale(t,e){e&&this.translate(e),this.ctx.scale(t.x,t.y),e&&this.translate(e.inverted())}rotate(t,e){e&&this.translate(e),this.ctx.rotate(t),e&&this.translate(e.inverted())}resetTransform(){this.ctx.resetTransform()}saveCtx(){this.ctx.save()}restoreCtx(){this.ctx.restore()}screenToWorld(t){const e=this.ctx.getTransform().inverse();return new h(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f)}worldToScreen(t){const e=this.ctx.getTransform();return new h(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f)}clipRect(t,e){this.clip(i=>i.rect(t.x,t.y,e.x,e.y))}clipCircle(t,e){this.clip(i=>i.arc(t.x,t.y,e,0,Math.PI*2))}clip(t){this.ctx.beginPath(),t(this.ctx),this.ctx.clip()}getImageData(t,e=new h(1,1)){return this.ctx.getImageData(t.x,t.y,e.x,e.y)}createImageData(t){return this.ctx.createImageData(t.x,t.y)}putImageData(t,e){this.ctx.putImageData(t,e.x,e.y)}getPixel(t){console.error("todo")}}class K{constructor(t,e=i=>{}){this.onResize=e,this.element=t}}class G extends K{constructor(t,e){super(t,e),new ResizeObserver(r=>{let s=new h(this.element.width,this.element.height);for(const o of r)this.element.width=o.contentRect.width,this.element.height=o.contentRect.height;this.onResize(new h(this.element.width,this.element.height),s)}).observe(this.element)}}class J extends G{constructor(t,e){super(t,e),t.style.width="100%",t.style.height="100%"}}const d=R.fromParent(document.body);new J(d.element);let V={wallsResetVel:!1},x=200,v=50,M=new h(window.innerWidth-x/2,window.innerHeight-x/2),f,W=1,c,w=10,Q=1/2,C=!0;const L=document.querySelector(".elastic-input");L.addEventListener("input",n=>C=L.checked);const Z=document.querySelector(".draw-freq-display"),_=document.querySelector(".draw-freq-input-range"),z=document.querySelector(".draw-freq-input-number");z.addEventListener("input",n=>$(z.value));_.addEventListener("input",n=>$(_.value));function $(n){n=parseInt(n),w=n,Z.innerHTML=w.toString(),z.value=w,_.value=w}const k=document.querySelector(".wall-reflect-input");k.addEventListener("input",n=>{V.wallsResetVel=!k.checked});const tt=document.querySelector(".clear-btn");tt.addEventListener("click",n=>p.forEach(t=>t.points=[]));const et=document.querySelector(".delete-obj-btn");et.addEventListener("click",n=>{c&&(p.splice(p.findIndex(t=>c===t),1),c=void 0)});const it=document.querySelector(".radius-display"),q=document.querySelector(".radius-input-range"),E=document.querySelector(".radius-input-number");q.addEventListener("input",n=>I(q.value));E.addEventListener("input",n=>I(E.value));function I(n){let t=parseInt(n);c&&(c.radius=t),v=t,it.innerHTML=t.toString(),q.value=t,E.value=t}const T=document.querySelector(".mass-input-number");T.addEventListener("input",n=>{A(T.value)});function A(n){let t=parseFloat(n);T.value=n,W=t,c&&(c.mass=t)}let N=0;class y{constructor(t,e,i){m(this,"pos");m(this,"nextPos");m(this,"vel");m(this,"nextVel");m(this,"disabled",!1);m(this,"radius");m(this,"mass");m(this,"points",[]);this.pos=t,this.nextPos=t.copy(),this.vel=new h(0,0),this.nextVel=this.vel.copy(),this.radius=e,this.mass=i}get impulse(){return this.vel.multS(this.mass)}set impulse(t){this.vel=t.divS(this.mass)}draw(t){t.drawCircle(this.pos,this.radius)}drawBg(t){var r;let e=(r=this.points[0])==null?void 0:r.time,i=1/w;for(let s=1;s<this.points.length;s++){for(;this.points[s].time-e>i;)e+=i;this.points[s].time-e<i*Q&&t.drawLine(this.points[s-1].pos,this.points[s].pos,{width:2,cap:"round"})}}update(t,e,i){let r=this.pos.add(this.vel.multS(t));const s=new h(0,0),o=new h(window.innerWidth-x,window.innerHeight);let l=this.outsideRect(r,s,o);if(l.genral){if(l.x){let u=this.getOvershoot(r,s,o),g=this.getNormal(l);r=r.sub(u).add(y.reflect(u,new h(g.x,0))),this.nextVel=this.vel.mult(new h(-1,1))}if(l.y){let u=this.getOvershoot(r,s,o),g=this.getNormal(l);r=r.sub(u).add(y.reflect(u,new h(0,g.y))),this.nextVel=this.nextVel.mult(new h(1,-1))}V.wallsResetVel&&(this.nextVel=new h(0,0),this.vel=this.nextVel.copy())}for(const u of e){if(u===this)continue;let g=this.getCollision(u);if(g){let S=g.position.sub(r);if(i.drawCircle(g.position,10,{color:a.red}),r=g.position.add(S),r=g.position,i.drawCircle(r,5,{color:a.blue}),C){let P=this.vel.multS(this.mass-u.mass).add(u.vel.multS(2*u.mass)).divS(this.mass+u.mass);this.nextVel=P}else{let P=this.impulse.add(u.impulse).divS(this.mass+u.mass);this.nextVel=P}}}this.nextPos=r}lateUpdate(t){this.vel=this.nextVel,(this.points.length<1||this.points[this.points.length-1].pos.sub(this.pos).magnitude()>1)&&this.points.push({time:N,pos:this.pos}),this.pos=this.nextPos,this.nextVel=this.nextVel.multS(.99)}static reflect(t,e){return t.sub(e.multS(2*t.dot(e)))}getNormal(t){return new h((t.left?1:0)+(t.right?-1:0),(t.top?-1:0)+(t.bottom?1:0))}getCollision(t){if(t.pos.sub(this.pos).magnitude()<this.radius+t.radius){let e=this.pos.sub(t.pos).normalized(),i=t.pos.add(e.multS(t.radius+this.radius));return{normal:e,position:i}}}getOvershoot(t,e,i){let r=this.outsideRect(t,e,i);return new h(r.left?e.x+t.x-this.radius:r.right?t.x-(e.x+i.x)+this.radius:0,r.top?e.y+t.y-this.radius:r.bottom?t.y-(e.y+i.y)+this.radius:0)}outsideRect(t,e,i){let r=t.x-this.radius<e.x,s=t.x+this.radius>e.x+i.x,o=t.y-this.radius<e.y,l=t.y+this.radius>e.y+i.y;return{genral:r||s||o||l,x:r||s,y:o||l,left:r,right:s,top:o,bottom:l}}}class rt{constructor(t,e){m(this,"pos");m(this,"oldPos");m(this,"dragging");this.pos=t,this.oldPos=this.pos.copy(),this.dragging=e}setPos(t){this.pos=t}delta(){const t=this.pos.sub(this.oldPos);return this.oldPos=this.pos.copy(),t}}let b=new Map;window.addEventListener("touchstart",n=>{for(let t=0;t<n.touches.length;t++){let e=n.touches[t],i=new h(e.clientX,e.clientY);i.sub(M).magnitude()<v&&(f={pos:i,pointer:e.identifier});let r;for(const s of p)if(s.pos.sub(i).magnitude()<s.radius){r=s,r.disabled=!0;break}b.set(e.identifier,new rt(i,r))}},{passive:!1});d.element.addEventListener("touchmove",n=>{var t;n.preventDefault();for(let e=0;e<n.touches.length;e++){let i=n.touches[e];(t=b.get(i.identifier))==null||t.setPos(new h(i.clientX,i.clientY))}},{passive:!1});d.element.addEventListener("click",n=>{const t=new h(n.clientX,n.clientY);let e=!1;for(const i of p)if(i.pos.sub(t).magnitude()<i.radius){c=i,A(c.mass.toString()),I(c.radius.toString()),e=!0;break}e||(c=void 0)});d.element.addEventListener("dblclick",n=>{n.preventDefault();const t=new h(n.clientX,n.clientY);for(const e of p)if(e.pos.sub(t).magnitude()<e.radius){e.points=[];break}c=void 0});window.addEventListener("touchend",n=>{var t;for(let e=0;e<n.changedTouches.length;e++){f&&n.changedTouches[e].identifier===f.pointer&&(F()&&p.push(new y(f.pos,v,W)),f=void 0);let i=(t=b.get(n.changedTouches[e].identifier))==null?void 0:t.dragging;i&&(i.disabled=!1),b.delete(n.changedTouches[e].identifier)}},{passive:!1});function F(){if(!f)return!1;for(const n of p)if(n.pos.sub(f.pos).magnitude()<v+n.radius)return!1;return!0}let p=[],D=Date.now();function H(){let n=Date.now(),t=(n-D)/1e3;d.clear(),d.beginDraw(),p.forEach(e=>e.drawBg(d)),p.forEach(e=>e.draw(d)),c&&d.drawCircle(c.pos,c.radius+10,{fill:!1,borderWidth:2,borderColor:a.red}),p.forEach(e=>{e.update(1,p,d)}),p.forEach(e=>{e.lateUpdate(1)}),b.forEach((e,i)=>{const r=e.delta();d.drawCircle(e.pos,10),e.dragging&&(e.dragging.vel=r,e.dragging.nextVel=r),f&&f.pointer===i&&(f.pos=f.pos.add(r))}),M=new h(window.innerWidth-x/2,window.innerHeight-x/2),d.drawRect(new h(window.innerWidth-x,0),new h(x,window.innerHeight),{color:a.hex("#111111")}),d.drawCircle(M,v),f&&d.drawCircle(f.pos,v,{color:F()?a.hex("#004400"):a.hex("#222222")}),d.endDraw(),N+=t,D=n,requestAnimationFrame(H)}requestAnimationFrame(H);
